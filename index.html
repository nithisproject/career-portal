<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Placement Portal Access</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{height:100vh;display:flex;justify-content:center;align-items:center;background:linear-gradient(-45deg,#667eea,#764ba2,#6a11cb,#2575fc);background-size:400% 400%;animation:gradientBG 10s ease infinite;overflow:auto;}
@keyframes gradientBG{0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
.container{width:400px;background:rgba(255,255,255,0.15);backdrop-filter:blur(15px);padding:30px;border-radius:20px;box-shadow:0 0 40px rgba(0,0,0,0.3);}
h2{text-align:center;color:white;margin-bottom:20px;font-weight:600;}
.tabs{display:flex;margin-bottom:20px;}
.tabs button{flex:1;padding:10px;border:none;cursor:pointer;background:rgba(255,255,255,0.2);color:white;transition:0.3s;}
.tabs button.active{background:white;color:black;font-weight:bold;}
input, textarea{width:100%;padding:12px;margin:8px 0;border:none;border-radius:10px;outline:none;}
textarea{resize:none;height:60px;}
button.submit{width:100%;padding:12px;margin-top:10px;border:none;border-radius:10px;background:white;font-weight:bold;cursor:pointer;transition:0.3s;}
button.submit:hover{background:#ddd;}
.hidden{display:none;}
.toggle-link{text-align:center;margin-top:10px;color:white;cursor:pointer;font-size:14px;}
</style>
</head>
<body>

<div class="container">
<div class="tabs">
<button id="adminTab" class="active" onclick="showAdmin()">Admin</button>
<button id="studentTab" onclick="showStudent()">Student</button>
</div>

<!-- ADMIN LOGIN -->
<div id="adminSection">
<h2>Admin Login</h2>
<input type="email" id="adminEmail" placeholder="Admin Email" required>
<input type="password" id="adminPassword" placeholder="Password" required>
<button class="submit" onclick="adminLogin()">Login</button>
</div>

<!-- STUDENT SECTION -->
<div id="studentSection" class="hidden">

<!-- Student Login -->
<div id="studentLogin">
<h2>Student Login</h2>
<input type="email" id="studentEmail" placeholder="Email" required>
<input type="password" id="studentPassword" placeholder="Password" required>
<button class="submit" onclick="studentLogin()">Login</button>
<div class="toggle-link" onclick="toggleStudentForm()">New Student? Register</div>
</div>

<!-- Student Register -->
<div id="studentRegister" class="hidden">
<h2>Student Register</h2>

<input type="text" id="fullName" placeholder="Full Name" required>
<input type="text" id="degree" placeholder="Degree" required>
<input type="text" id="department" placeholder="Department" required>
<input type="number" step="0.01" id="cgpa" placeholder="CGPA" required>
<textarea id="skills" placeholder="Skills (comma separated)" required></textarea>

<input type="email" id="regEmail" placeholder="Email" required>
<input type="password" id="regPassword" placeholder="Password" required>

<button class="submit" onclick="studentRegister()">Register</button>
<div class="toggle-link" onclick="toggleStudentForm()">Already have account? Login</div>
</div>

</div>
</div>

<script>
const { createClient } = supabase;
const supabaseClient = createClient(
  "https://mpcvctbrinkzdohjrpth.supabase.co",
  "sb_publishable_toAs6cvoLBqIpDEzVzabuA_KDUtaUvl"
);

// Tab Functions
function showAdmin(){
  document.getElementById("adminSection").classList.remove("hidden");
  document.getElementById("studentSection").classList.add("hidden");
  document.getElementById("adminTab").classList.add("active");
  document.getElementById("studentTab").classList.remove("active");
}
function showStudent(){
  document.getElementById("studentSection").classList.remove("hidden");
  document.getElementById("adminSection").classList.add("hidden");
  document.getElementById("studentTab").classList.add("active");
  document.getElementById("adminTab").classList.remove("active");
}
function toggleStudentForm(){
  document.getElementById("studentLogin").classList.toggle("hidden");
  document.getElementById("studentRegister").classList.toggle("hidden");
}

// ADMIN LOGIN
async function adminLogin(){
  const email = document.getElementById("adminEmail").value;
  const password = document.getElementById("adminPassword").value;

  const { data, error } = await supabaseClient
    .from('users')
    .select('*')
    .eq('email', email)
    .eq('password', password)
    .eq('role', 'admin')
    .single();

  if(data){
    sessionStorage.setItem("user", JSON.stringify(data));
    window.location="Admin.html";
  }else{
    alert("Invalid Admin Credentials");
  }
}

// STUDENT REGISTER
async function studentRegister(){

  const fullName = document.getElementById("fullName").value;
  const degree = document.getElementById("degree").value;
  const department = document.getElementById("department").value;
  const cgpa = parseFloat(document.getElementById("cgpa").value);
  const skills = document.getElementById("skills").value;
  const email = document.getElementById("regEmail").value;
  const password = document.getElementById("regPassword").value;

  // 1️⃣ Insert into users table
  const { data: userData, error: userError } = await supabaseClient
    .from('users')
    .insert([{ email:email, password:password, role: 'student' }])
    .select()
    .single();

  if(userError){
    alert("Email already registered!");
    return;
  }

  // 2️⃣ Insert into student_profiles table
  const { error: profileError } = await supabaseClient
    .from('student_profiles')
    .insert([{
      user_id: userData.id,
      full_name: fullName,
      degree: degree,
      department: department,
      cgpa: cgpa,
      skills: skills
    }]);

  if(profileError){
    alert("Profile creation failed!");
    return;
  }

  alert("Registration successful! Please login.");
  toggleStudentForm();
}

// STUDENT LOGIN
async function studentLogin(){
  const email = document.getElementById("studentEmail").value;
  const password = document.getElementById("studentPassword").value;

  const { data, error } = await supabaseClient
    .from('users')
    .select('*')
    .eq('email', email)
    .eq('password', password)
    .eq('role', 'student')
    .single();

  if(data){
    sessionStorage.setItem("user", JSON.stringify(data));
    window.location="Student.html";
  }else{
    alert("Invalid Student Credentials");
  }
}
</script>

</body>
</html>
